<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Code Text Cleaner Pro</title>
  <meta name="description" content="Offline toolbox: text utilities, code cleaner, html decoder, combine/split html-css-js, drag & drop, preview." />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
  <style>
    :root {
      /* VS Code + GitHub Dark Mode Color Palette */
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --bg-tertiary: #21262d;
      --bg-overlay: #30363d;
      --bg-editor: #0d1117;
      --bg-sidebar: #161b22;
      --bg-activity-bar: #21262d;
      --bg-light: #ffffff;
      --bg-light-secondary: #f6f8fa;
      --bg-light-tertiary: #d0d7de;
      --border-default: #30363d;
      --border-muted: #21262d;
      --border-light: #d0d7de;
      --text-primary: #c9d1d9;
      --text-secondary: #8b949e;
      --text-tertiary: #6e7681;
      --text-light-primary: #24292f;
      --text-light-secondary: #57606a;
      --text-light-tertiary: #656d76;
      --accent-primary: #58a6ff;
      --accent-secondary: #1f6feb;
      --accent-success: #3fb950;
      --accent-danger: #f85149;
      --accent-warning: #d29922;
      --accent-info: #58a6ff;
      --code-bg: #0d1117;
      --code-border: #30363d;
      --shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
      --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.1);
      --radius: 6px;
      --transition: all 0.2s ease;
      --editor-font-size: 14px;
      --sidebar-width: 48px;
      --sidebar-expanded-width: 220px;
    }

    /* Light Theme */
    body.light-theme {
      --bg-primary: #ffffff;
      --bg-secondary: #f6f8fa;
      --bg-tertiary: #d0d7de;
      --bg-overlay: #d0d7de;
      --bg-editor: #ffffff;
      --bg-sidebar: #f6f8fa;
      --bg-activity-bar: #d0d7de;
      --border-default: #d0d7de;
      --border-muted: #d0d7de;
      --text-primary: #24292f;
      --text-secondary: #57606a;
      --text-tertiary: #656d76;
      --code-bg: #f6f8fa;
      --code-border: #d0d7de;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji';
      background-color: var(--bg-primary);
      color: var(--text-primary);
      font-size: 14px;
      line-height: 1.5;
      min-height: 100vh;
      overflow-x: hidden;
      transition: background-color 0.3s, color 0.3s;
    }

    /* Layout */
    .app-container {
      display: flex;
      height: 100vh;
    }

    /* Activity Bar (VS Code style) */
    .activity-bar {
      width: var(--sidebar-width);
      background-color: var(--bg-activity-bar);
      border-right: 1px solid var(--border-default);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 0;
      transition: var(--transition);
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 4px 0;
      border-radius: var(--radius);
      color: var(--text-tertiary);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
    }

    .activity-icon:hover {
      background-color: var(--bg-overlay);
      color: var(--text-primary);
    }

    .activity-icon.active {
      color: var(--text-primary);
    }

    .activity-icon.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 3px;
      background-color: var(--accent-primary);
      border-radius: 0 3px 3px 0;
    }

    .activity-icon .tooltip {
      position: absolute;
      left: calc(100% + 10px);
      top: 50%;
      transform: translateY(-50%);
      background-color: var(--bg-overlay);
      color: var(--text-primary);
      padding: 6px 10px;
      border-radius: var(--radius);
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 100;
      box-shadow: var(--shadow);
    }

    .activity-icon:hover .tooltip {
      opacity: 1;
    }

    .activity-divider {
      width: 80%;
      height: 1px;
      background-color: var(--border-default);
      margin: 8px 0;
    }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-expanded-width);
      background-color: var(--bg-sidebar);
      border-right: 1px solid var(--border-default);
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow-y: auto;
      transition: var(--transition);
      transform: translateX(-100%);
      position: absolute;
      left: var(--sidebar-width);
      top: 0;
      bottom: 0;
      z-index: 10;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
    }

    .sidebar.expanded {
      transform: translateX(0);
    }

    .sidebar-header {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-default);
    }

    .sidebar-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .sidebar-close {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius);
      color: var(--text-tertiary);
      cursor: pointer;
      transition: var(--transition);
    }

    .sidebar-close:hover {
      background-color: var(--bg-overlay);
      color: var(--text-primary);
    }

    .brand {
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--border-default);
    }

    .brand .logo {
      width: 32px;
      height: 32px;
      border-radius: var(--radius);
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
      flex-shrink: 0;
    }

    .brand h1 {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .brand small {
      display: block;
      font-size: 11px;
      color: var(--text-tertiary);
      margin-top: 2px;
    }

    nav {
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .tab-btn {
      padding: 8px 12px;
      border-radius: var(--radius);
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-primary);
      font-weight: 500;
      cursor: pointer;
      text-align: left;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .tab-btn:hover {
      background-color: var(--bg-tertiary);
    }

    .tab-btn.active {
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      border-left: 3px solid var(--accent-primary);
    }

    .tab-btn i {
      width: 16px;
      text-align: center;
    }

    .footer {
      margin-top: auto;
      padding: 16px;
      font-size: 11px;
      color: var(--text-tertiary);
      border-top: 1px solid var(--border-default);
      text-align: center;
    }

    /* Main Content */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background-color: var(--bg-primary);
    }

    /* Title Bar (VS Code style) */
    .title-bar {
      height: 35px;
      background-color: var(--bg-activity-bar);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px;
      border-bottom: 1px solid var(--border-default);
      -webkit-app-region: drag;
    }

    .title-bar-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-bar-title {
      font-size: 13px;
      color: var(--text-primary);
    }

    .title-bar-actions {
      display: flex;
      gap: 8px;
    }

    .title-bar-action {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      cursor: pointer;
      -webkit-app-region: no-drag;
    }

    .title-bar-action.close {
      background-color: var(--accent-danger);
    }

    .title-bar-action.minimize {
      background-color: var(--accent-warning);
    }

    .title-bar-action.maximize {
      background-color: var(--accent-success);
    }

    /* Toolbar */
    .toolbar {
      padding: 12px 16px;
      background-color: var(--bg-secondary);
      border-bottom: 1px solid var(--border-default);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }

    .tool-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tool-title i {
      color: var(--accent-primary);
    }

    .actions {
      display: flex;
      gap: 8px;
    }

    .btn {
      padding: 5px 10px;
      border-radius: var(--radius);
      border: 1px solid var(--border-default);
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      cursor: pointer;
      font-weight: 500;
      font-size: 12px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn:hover {
      background-color: var(--bg-overlay);
      border-color: var(--accent-primary);
    }

    .btn i {
      font-size: 12px;
    }

    .btn-danger {
      color: var(--accent-danger);
      border-color: var(--accent-danger);
    }

    .btn-danger:hover {
      background-color: rgba(248, 81, 73, 0.1);
    }

    .btn-primary {
      background-color: var(--accent-primary);
      color: white;
      border-color: var(--accent-primary);
    }

    .btn-primary:hover {
      background-color: var(--accent-secondary);
      border-color: var(--accent-secondary);
    }

    .btn-success {
      background-color: var(--accent-success);
      color: white;
      border-color: var(--accent-success);
    }

    .btn-success:hover {
      background-color: #2ea043;
      border-color: #2ea043;
    }

    /* Panels */
    .panel {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: none;
    }

    .panel.active {
      display: flex;
      flex-direction: column;
    }

    /* Code Editor Style */
    .editor-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      height: 100%;
    }

    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 10px;
      background-color: var(--bg-tertiary);
      border-radius: var(--radius) var(--radius) 0 0;
      border: 1px solid var(--border-default);
      border-bottom: none;
    }

    .editor-title {
      font-weight: 600;
      font-size: 13px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .editor-title i {
      color: var(--accent-primary);
    }

    .editor-actions {
      display: flex;
      gap: 6px;
    }

    .editor-wrapper {
      position: relative;
      flex: 1;
      border: 1px solid var(--border-default);
      border-radius: 0 0 var(--radius) var(--radius);
      overflow: hidden;
    }

    .editor {
      width: 100%;
      height: 100%;
      min-height: 300px;
      padding: 16px;
      background-color: var(--code-bg);
      color: var(--text-primary);
      font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', 'SF Mono', Consolas, 'Courier New', monospace;
      font-size: var(--editor-font-size);
      line-height: 1.5;
      resize: none;
      border: none;
      outline: none;
      white-space: pre;
      overflow-wrap: normal;
      overflow-x: auto;
      tab-size: 2;
    }

    .editor:focus {
      box-shadow: inset 0 0 0 2px var(--accent-primary);
    }

    .editor.word-wrap {
      white-space: pre-wrap;
      overflow-wrap: break-word;
      overflow-x: hidden;
    }

    .line-numbers {
      position: absolute;
      top: 0;
      left: 0;
      width: 50px;
      height: 100%;
      padding: 16px 8px;
      background-color: var(--bg-tertiary);
      color: var(--text-tertiary);
      font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', 'SF Mono', Consolas, 'Courier New', monospace;
      font-size: var(--editor-font-size);
      line-height: 1.5;
      text-align: right;
      user-select: none;
      border-right: 1px solid var(--border-default);
      overflow: hidden;
    }

    .editor-content {
      padding-left: 50px;
      height: 100%;
      overflow: auto;
    }

    .editor-content.no-line-numbers {
      padding-left: 16px;
    }

    /* Dropzone */
    .dropzone {
      border: 2px dashed var(--border-muted);
      padding: 24px;
      border-radius: var(--radius);
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 16px;
      background-color: var(--bg-tertiary);
      transition: var(--transition);
      cursor: pointer;
    }

    .dropzone.dragover {
      border-color: var(--accent-primary);
      background-color: rgba(88, 166, 255, 0.1);
      color: var(--text-primary);
    }

    .dropzone:hover {
      border-color: var(--border-default);
    }

    .dropzone i {
      font-size: 24px;
      margin-bottom: 8px;
      color: var(--accent-primary);
    }

    /* Controls */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .control-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      flex: 1;
    }

    /* Preview */
    .preview-container {
      margin-top: 16px;
      border: 1px solid var(--border-default);
      border-radius: var(--radius);
      overflow: hidden;
      height: 400px;
      display: flex;
      flex-direction: column;
    }

    .preview-header {
      padding: 6px 10px;
      background-color: var(--bg-tertiary);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .preview-title {
      font-weight: 600;
      font-size: 13px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .preview-title i {
      color: var(--accent-primary);
    }

    .preview-actions {
      display: flex;
      gap: 6px;
    }

    .preview-frame {
      flex: 1;
      width: 100%;
      border: none;
      background-color: white;
    }

    /* Stats */
    .stats {
      display: flex;
      gap: 16px;
      margin-top: 12px;
      padding: 8px 12px;
      background-color: var(--bg-tertiary);
      border-radius: var(--radius);
      font-size: 12px;
      color: var(--text-secondary);
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stat-label {
      color: var(--text-tertiary);
    }

    /* Find and Replace */
    .find-replace-container {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: var(--bg-overlay);
      border: 1px solid var(--border-default);
      border-radius: var(--radius);
      padding: 10px;
      z-index: 100;
      box-shadow: var(--shadow);
      min-width: 300px;
    }

    .find-replace-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .find-replace-title {
      font-weight: 600;
      font-size: 13px;
      color: var(--text-primary);
    }

    .find-replace-close {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius);
      color: var(--text-tertiary);
      cursor: pointer;
      transition: var(--transition);
    }

    .find-replace-close:hover {
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .find-replace-input {
      width: 100%;
      padding: 6px 10px;
      border-radius: var(--radius);
      border: 1px solid var(--border-default);
      background-color: var(--bg-primary);
      color: var(--text-primary);
      font-size: 12px;
      margin-bottom: 8px;
    }

    .find-replace-input:focus {
      outline: none;
      border-color: var(--accent-primary);
    }

    .find-replace-actions {
      display: flex;
      gap: 6px;
      margin-top: 10px;
    }

    .find-replace-info {
      font-size: 11px;
      color: var(--text-tertiary);
      margin-top: 6px;
    }

    /* History Panel */
    .history-container {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid var(--border-default);
      border-radius: var(--radius);
      margin-top: 12px;
    }

    .history-item {
      padding: 8px 12px;
      border-bottom: 1px solid var(--border-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: var(--transition);
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-item:hover {
      background-color: var(--bg-tertiary);
    }

    .history-action {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .history-time {
      font-size: 11px;
      color: var(--text-tertiary);
    }

    .history-restore {
      padding: 2px 6px;
      border-radius: 3px;
      background-color: var(--bg-overlay);
      color: var(--text-primary);
      font-size: 11px;
      cursor: pointer;
      transition: var(--transition);
    }

    .history-restore:hover {
      background-color: var(--accent-primary);
      color: white;
    }

    /* Regex Tester */
    .regex-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .regex-input-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .regex-input {
      flex: 1;
      padding: 8px 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border-default);
      background-color: var(--bg-primary);
      color: var(--text-primary);
      font-family: monospace;
    }

    .regex-flags {
      display: flex;
      gap: 8px;
    }

    .regex-flag {
      padding: 4px 8px;
      border-radius: 3px;
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 11px;
      cursor: pointer;
      transition: var(--transition);
    }

    .regex-flag.active {
      background-color: var(--accent-primary);
      color: white;
    }

    .regex-result {
      padding: 8px 12px;
      border-radius: var(--radius);
      background-color: var(--bg-tertiary);
      font-family: monospace;
      font-size: 12px;
      min-height: 100px;
    }

    .regex-match {
      background-color: rgba(88, 166, 255, 0.3);
      padding: 2px 0;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background-color: var(--bg-overlay);
      color: var(--text-primary);
      padding: 12px 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      border: 1px solid var(--border-default);
      font-weight: 500;
      max-width: 90%;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .toast.success {
      border-color: var(--accent-success);
      background-color: rgba(63, 185, 80, 0.1);
    }

    .toast.error {
      border-color: var(--accent-danger);
      background-color: rgba(248, 81, 73, 0.1);
    }

    .toast.warning {
      border-color: var(--accent-warning);
      background-color: rgba(210, 153, 34, 0.1);
    }

    /* Settings Panel */
    .settings-group {
      margin-bottom: 20px;
    }

    .settings-group h3 {
      margin-bottom: 10px;
      color: var(--text-primary);
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .settings-group h3 i {
      color: var(--accent-primary);
    }

    .settings-control {
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .settings-control label {
      flex: 1;
      color: var(--text-secondary);
    }

    .settings-control input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .settings-control input[type="range"] {
      flex: 2;
      cursor: pointer;
    }

    .settings-control .range-value {
      min-width: 40px;
      text-align: right;
      color: var(--text-primary);
    }

    /* Keyboard Shortcuts */
    .shortcuts-container {
      background-color: var(--bg-tertiary);
      border-radius: var(--radius);
      padding: 16px;
      margin-top: 12px;
    }

    .shortcuts-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
    }

    .shortcut-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid var(--border-muted);
    }

    .shortcut-item:last-child {
      border-bottom: none;
    }

    .shortcut-desc {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .shortcut-key {
      padding: 2px 6px;
      border-radius: 3px;
      background-color: var(--bg-overlay);
      color: var(--text-primary);
      font-family: monospace;
      font-size: 11px;
    }

    /* Case Conversion Options */
    .case-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px;
      margin-top: 12px;
    }

    .case-option {
      padding: 8px 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border-default);
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 12px;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
    }

    .case-option:hover {
      background-color: var(--bg-overlay);
      border-color: var(--accent-primary);
    }

    /* Detailed Stats */
    .detailed-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .stat-card {
      padding: 12px;
      border-radius: var(--radius);
      background-color: var(--bg-tertiary);
      border: 1px solid var(--border-default);
    }

    .stat-card-title {
      font-size: 12px;
      color: var(--text-tertiary);
      margin-bottom: 4px;
    }

    .stat-card-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* Syntax Highlighting */
    .syntax-highlighted {
      padding: 16px;
      background-color: var(--code-bg);
      border-radius: var(--radius);
      overflow-x: auto;
    }

    pre[class*="language-"] {
      margin: 0;
      padding: 0;
      background: transparent;
    }

    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid var(--border-default);
      border-radius: 50%;
      border-top-color: var(--accent-primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .app-container {
        flex-direction: column;
      }
      
      .activity-bar {
        width: 100%;
        height: var(--sidebar-width);
        flex-direction: row;
        overflow-x: auto;
        padding: 0 8px;
      }
      
      .activity-icon {
        margin: 0 4px;
      }
      
      .sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid var(--border-default);
        position: relative;
        left: 0;
        transform: none;
      }
      
      .brand {
        padding: 12px;
      }
      
      .brand .logo {
        width: 28px;
        height: 28px;
        font-size: 14px;
      }
      
      .brand h1 {
        font-size: 13px;
      }
      
      nav {
        padding: 8px;
        flex-direction: row;
        overflow-x: auto;
        gap: 8px;
      }
      
      .tab-btn {
        padding: 6px 10px;
        font-size: 12px;
        white-space: nowrap;
      }
      
      .toolbar {
        padding: 10px 12px;
      }
      
      .tool-title {
        font-size: 14px;
      }
      
      .btn {
        padding: 4px 8px;
        font-size: 11px;
      }
      
      .editor {
        min-height: 200px;
      }
      
      .preview-container {
        height: 300px;
      }
      
      .find-replace-container {
        min-width: 250px;
      }
      
      .detailed-stats {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Activity Bar (VS Code style) -->
    <div class="activity-bar">
      <div class="activity-icon active" data-tool="text">
        <i class="fas fa-file-alt"></i>
        <span class="tooltip">Text Tools</span>
      </div>
      <div class="activity-icon" data-tool="code">
        <i class="fas fa-code"></i>
        <span class="tooltip">Code Cleaner</span>
      </div>
      <div class="activity-icon" data-tool="decoder">
        <i class="fas fa-lock"></i>
        <span class="tooltip">HTML Decoder</span>
      </div>
      <div class="activity-icon" data-tool="combine">
        <i class="fas fa-object-group"></i>
        <span class="tooltip">Combine</span>
      </div>
      <div class="activity-icon" data-tool="split">
        <i class="fas fa-code-branch"></i>
        <span class="tooltip">Split</span>
      </div>
      <div class="activity-icon" data-tool="regex">
        <i class="fas fa-search"></i>
        <span class="tooltip">Regex Tester</span>
      </div>
      <div class="activity-divider"></div>
      <div class="activity-icon" data-tool="settings">
        <i class="fas fa-cog"></i>
        <span class="tooltip">Settings</span>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">EXPLORER</div>
        <div class="sidebar-close" id="sidebarClose">
          <i class="fas fa-times"></i>
        </div>
      </div>

      <header class="brand">
        <div class="logo"></div>
        <div>
          <h1>Code & Text Cleaner Pro</h1>
          <small>Proyek Beruntun Ke-5</small>
        </div>
      </header>

      <nav>
        <button class="tab-btn active" data-tool="text">
          <i class="fas fa-file-alt"></i>
          Text Tools
        </button>
        <button class="tab-btn" data-tool="code">
          <i class="fas fa-code"></i>
          Code Cleaner
        </button>
        <button class="tab-btn" data-tool="decoder">
          <i class="fas fa-lock"></i>
          HTML Decoder
        </button>
        <button class="tab-btn" data-tool="combine">
          <i class="fas fa-object-group"></i>
          Combine
        </button>
        <button class="tab-btn" data-tool="split">
          <i class="fas fa-code-branch"></i>
          Split
        </button>
        <button class="tab-btn" data-tool="regex">
          <i class="fas fa-search"></i>
          Regex Tester
        </button>
      </nav>

      <footer class="footer">
        <small>Thio Saputra � ATM � Amati Tiru Modifikasi</small>
        <button id="clearAll" class="btn" style="margin-top: 8px; width: 100%;">
          <i class="fas fa-trash"></i> Clear All Data
        </button>
      </footer>
    </aside>

    <main class="main">
      <!-- Title Bar (VS Code style) -->
      <div class="title-bar">
        <div class="title-bar-left">
          <div class="title-bar-title">Code Text Cleaner Pro</div>
        </div>
        <div class="title-bar-actions">
          <div class="title-bar-action minimize"></div>
          <div class="title-bar-action maximize"></div>
          <div class="title-bar-action close"></div>
        </div>
      </div>

      <div class="toolbar">
        <div class="tool-title" id="toolTitle">
          <i class="fas fa-file-alt"></i>
          Text Tools
        </div>
        <div class="actions">
          <button id="saveLocal" class="btn">
            <i class="fas fa-save"></i>
            Save
          </button>
          <button id="loadLocal" class="btn">
            <i class="fas fa-folder-open"></i>
            Load
          </button>
          <button id="reset" class="btn">
            <i class="fas fa-redo"></i>
            Reset
          </button>
          <button id="findReplaceBtn" class="btn">
            <i class="fas fa-search"></i>
            Find/Replace
          </button>
          <button id="themeToggle" class="btn">
            <i class="fas fa-moon"></i>
            Theme
          </button>
        </div>
      </div>

      <!-- TEXT TOOLS -->
      <section class="panel active" id="panel-text" data-tool="text">
        <div class="editor-container">
          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-file-alt"></i>
              Input
            </div>
            <div class="editor-actions">
              <button class="btn" id="pasteText">
                <i class="fas fa-paste"></i>
                Paste
              </button>
              <button class="btn" id="toggleWordWrap">
                <i class="fas fa-text-width"></i>
                Wrap
              </button>
              <button class="btn" id="copyWithLineNumbers">
                <i class="fas fa-copy"></i>
                Copy + Lines
              </button>
            </div>
          </div>
          <div class="dropzone" id="textDrop">
            <i class="fas fa-cloud-upload-alt"></i>
            <div>Drag & drop file (.txt/.md) or click to upload</div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="inputLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="inputText" class="editor" placeholder="Paste text or code here..."></textarea>
            </div>
          </div>

          <div class="controls">
            <div class="control-group">
              <button class="btn" data-action="lower">
                <i class="fas fa-font"></i> lowercase
              </button>
              <button class="btn" data-action="upper">
                <i class="fas fa-font"></i> UPPERCASE
              </button>
              <button class="btn" data-action="title">
                <i class="fas fa-heading"></i> Title Case
              </button>
              <button class="btn" data-action="trimspaces">
                <i class="fas fa-compress-alt"></i> Trim Spaces
              </button>
              <button class="btn" data-action="trimlines">
                <i class="fas fa-compress-alt"></i> Trim Lines
              </button>
              <button class="btn" data-action="reverse">
                <i class="fas fa-exchange-alt"></i> Reverse
              </button>
              <button class="btn" data-action="sort">
                <i class="fas fa-sort-alpha-down"></i> Sort
              </button>
              <button class="btn" data-action="dedupe">
                <i class="fas fa-filter"></i> Remove Dups
              </button>
            </div>
            <div class="control-group">
              <button class="btn" id="prettyJson">
                <i class="fas fa-code"></i> Prettify JSON
              </button>
              <button class="btn" id="minifyJson">
                <i class="fas fa-compress"></i> Minify JSON
              </button>
              <button class="btn" id="base64Encode">
                <i class="fas fa-lock"></i> Base64 Enc
              </button>
              <button class="btn" id="base64Decode">
                <i class="fas fa-unlock"></i> Base64 Dec
              </button>
              <button class="btn" id="urlEncode">
                <i class="fas fa-link"></i> URL Enc
              </button>
              <button class="btn" id="urlDecode">
                <i class="fas fa-unlink"></i> URL Dec
              </button>
            </div>
          </div>

          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-file-export"></i>
              Output
            </div>
            <div class="editor-actions">
              <button class="btn" id="copyOutput">
                <i class="fas fa-copy"></i>
                Copy
              </button>
              <button class="btn" id="downloadTxt">
                <i class="fas fa-download"></i>
                Download
              </button>
              <button class="btn" id="syntaxHighlight">
                <i class="fas fa-highlighter"></i>
                Highlight
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="outputLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="outputText" class="editor" readonly placeholder="Result will appear here..."></textarea>
            </div>
          </div>

          <div class="stats">
            <div class="stat-item">
              <i class="fas fa-font"></i>
              <span class="stat-label">Words:</span>
              <span id="wordCount">0</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-keyboard"></i>
              <span class="stat-label">Chars:</span>
              <span id="charCount">0</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-list-ol"></i>
              <span class="stat-label">Lines:</span>
              <span id="lineCount">0</span>
            </div>
          </div>

          <div class="detailed-stats" id="detailedStats" style="display: none;">
            <div class="stat-card">
              <div class="stat-card-title">Sentences</div>
              <div class="stat-card-value" id="sentenceCount">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-title">Paragraphs</div>
              <div class="stat-card-value" id="paragraphCount">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-title">Reading Time</div>
              <div class="stat-card-value" id="readingTime">0 min</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-title">Unique Words</div>
              <div class="stat-card-value" id="uniqueWords">0</div>
            </div>
          </div>

          <div class="case-options">
            <button class="case-option" data-case="camel">camelCase</button>
            <button class="case-option" data-case="pascal">PascalCase</button>
            <button class="case-option" data-case="snake">snake_case</button>
            <button class="case-option" data-case="kebab">kebab-case</button>
            <button class="case-option" data-case="constant">CONSTANT_CASE</button>
            <button class="case-option" data-case="dot">dot.case</button>
          </div>

          <div class="history-container" id="textHistory">
            <div class="history-item">
              <div>
                <div class="history-action">Welcome to Code Text Cleaner Pro</div>
                <div class="history-time">Just now</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- CODE CLEANER -->
      <section class="panel" id="panel-code" data-tool="code">
        <div class="editor-container">
          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-code"></i>
              Input (HTML / CSS / JS)
            </div>
            <div class="editor-actions">
              <button class="btn" id="pasteCode">
                <i class="fas fa-paste"></i>
                Paste
              </button>
              <button class="btn" id="toggleCodeWordWrap">
                <i class="fas fa-text-width"></i>
                Wrap
              </button>
              <button class="btn" id="copyCodeWithLineNumbers">
                <i class="fas fa-copy"></i>
                Copy + Lines
              </button>
            </div>
          </div>
          <div class="dropzone" id="codeDrop">
            <i class="fas fa-cloud-upload-alt"></i>
            <div>Drag & drop file (.html/.css/.js) or click to upload</div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="codeInputLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="codeInput" class="editor" placeholder="Paste HTML/CSS/JS here..."></textarea>
            </div>
          </div>

          <div class="controls">
            <div class="control-group">
              <button class="btn" data-code-action="minify-html">
                <i class="fas fa-compress"></i> Minify HTML
              </button>
              <button class="btn" data-code-action="minify-css">
                <i class="fas fa-compress"></i> Minify CSS
              </button>
              <button class="btn" data-code-action="minify-js">
                <i class="fas fa-compress"></i> Minify JS
              </button>
              <button class="btn" data-code-action="remove-comments">
                <i class="fas fa-comment-slash"></i> Remove Comments
              </button>
            </div>
            <div class="control-group">
              <button class="btn" id="formatHtml">
                <i class="fas fa-code"></i> Format HTML
              </button>
              <button class="btn" id="formatCss">
                <i class="fas fa-code"></i> Format CSS
              </button>
              <button class="btn" id="formatJs">
                <i class="fas fa-code"></i> Format JS
              </button>
              <button class="btn" id="beautifyJson">
                <i class="fas fa-code"></i> Beautify JSON
              </button>
            </div>
          </div>

          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-file-export"></i>
              Output
            </div>
            <div class="editor-actions">
              <button class="btn" id="copyCode">
                <i class="fas fa-copy"></i>
                Copy
              </button>
              <button class="btn" id="downloadCode">
                <i class="fas fa-download"></i>
                Download
              </button>
              <button class="btn btn-primary" id="previewCode">
                <i class="fas fa-eye"></i>
                Preview
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="codeOutputLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="codeOutput" class="editor" readonly placeholder="Cleaned code will appear here..."></textarea>
            </div>
          </div>

          <div class="preview-container hidden" id="previewWrap">
            <div class="preview-header">
              <div class="preview-title">
                <i class="fas fa-eye"></i>
                Live Preview
              </div>
              <div class="preview-actions">
                <button class="btn" id="refreshPreview">
                  <i class="fas fa-sync"></i>
                  Refresh
                </button>
                <button class="btn btn-danger" id="closePreview">
                  <i class="fas fa-times"></i>
                  Close
                </button>
              </div>
            </div>
            <iframe id="previewFrame" class="preview-frame" sandbox="allow-scripts"></iframe>
          </div>
        </div>
      </section>

      <!-- DECODER -->
      <section class="panel" id="panel-decoder" data-tool="decoder">
        <div class="editor-container">
          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-lock"></i>
              HTML Entities (Input)
            </div>
            <div class="editor-actions">
              <button class="btn" id="toggleDecoderWordWrap">
                <i class="fas fa-text-width"></i>
                Wrap
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="encodedLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="encoded" class="editor" placeholder="&amp;lt;div&amp;gt;Hello&amp;lt;/div&amp;gt;"></textarea>
            </div>
          </div>

          <div class="controls">
            <div class="control-group">
              <button class="btn btn-primary" id="decodeBtn">
                <i class="fas fa-unlock"></i> Decode Entities
              </button>
              <button class="btn" id="encodeBtn">
                <i class="fas fa-lock"></i> Encode
              </button>
              <button class="btn" id="autoDetectEntities">
                <i class="fas fa-magic"></i> Auto-detect
              </button>
            </div>
          </div>

          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-unlock"></i>
              Decoded
            </div>
            <div class="editor-actions">
              <button class="btn" id="copyDecoded">
                <i class="fas fa-copy"></i>
                Copy
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="decodedLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="decoded" class="editor" readonly placeholder="<div>Hello</div>"></textarea>
            </div>
          </div>
        </div>
      </section>

      <!-- COMBINE -->
      <section class="panel" id="panel-combine" data-tool="combine">
        <div class="editor-container">
          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-file-code"></i>
              HTML (body or fragment)
            </div>
            <div class="editor-actions">
              <button class="btn" id="toggleCombineHtmlWordWrap">
                <i class="fas fa-text-width"></i>
                Wrap
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="combineHtmlLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="combineHtml" class="editor" placeholder="Enter HTML (body or full HTML)"></textarea>
            </div>
          </div>

          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-palette"></i>
              CSS
            </div>
            <div class="editor-actions">
              <button class="btn" id="toggleCombineCssWordWrap">
                <i class="fas fa-text-width"></i>
                Wrap
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="combineCssLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="combineCss" class="editor" placeholder="Enter CSS (will be placed in <style> tag)"></textarea>
            </div>
          </div>

          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-laptop-code"></i>
              JavaScript
            </div>
            <div class="editor-actions">
              <button class="btn" id="toggleCombineJsWordWrap">
                <i class="fas fa-text-width"></i>
                Wrap
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="combineJsLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="combineJs" class="editor" placeholder="Enter JavaScript (will be placed in <script> tag)"></textarea>
            </div>
          </div>

          <div class="controls">
            <div class="control-group">
              <button class="btn btn-primary" id="combineBtn">
                <i class="fas fa-object-group"></i> Combine into HTML
              </button>
              <button class="btn" id="downloadCombined">
                <i class="fas fa-download"></i> Download .html
              </button>
              <button class="btn" id="copyCombined">
                <i class="fas fa-copy"></i> Copy
              </button>
              <button class="btn btn-primary" id="previewCombined">
                <i class="fas fa-eye"></i> Preview
              </button>
            </div>
          </div>

          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-file-export"></i>
              Combined Output
            </div>
            <div class="editor-actions">
              <button class="btn" id="toggleCombinedOutputWordWrap">
                <i class="fas fa-text-width"></i>
                Wrap
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="combinedOutputLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="combinedOutput" class="editor" readonly></textarea>
            </div>
          </div>

          <div class="preview-container hidden" id="previewCombinedWrap">
            <div class="preview-header">
              <div class="preview-title">
                <i class="fas fa-eye"></i>
                Combined Preview
              </div>
              <div class="preview-actions">
                <button class="btn" id="refreshCombinedPreview">
                  <i class="fas fa-sync"></i>
                  Refresh
                </button>
                <button class="btn btn-danger" id="closeCombinedPreview">
                  <i class="fas fa-times"></i>
                  Close
                </button>
              </div>
            </div>
            <iframe id="previewCombined" class="preview-frame" sandbox="allow-scripts"></iframe>
          </div>
        </div>
      </section>

      <!-- SPLIT -->
      <section class="panel" id="panel-split" data-tool="split">
        <div class="editor-container">
          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-file-code"></i>
              Input HTML (with &lt;style&gt; and/or &lt;script&gt;)
            </div>
            <div class="editor-actions">
              <button class="btn" id="toggleSplitInputWordWrap">
                <i class="fas fa-text-width"></i>
                Wrap
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="splitInputLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="splitInput" class="editor" placeholder="Paste full HTML here..."></textarea>
            </div>
          </div>

          <div class="controls">
            <div class="control-group">
              <button class="btn btn-primary" id="splitBtn">
                <i class="fas fa-code-branch"></i> Split HTML  HTML / CSS / JS
              </button>
              <button class="btn" id="downloadHtml">
                <i class="fas fa-download"></i> Download HTML
              </button>
              <button class="btn" id="downloadCss">
                <i class="fas fa-download"></i> Download CSS
              </button>
              <button class="btn" id="downloadJs">
                <i class="fas fa-download"></i> Download JS
              </button>
              <button class="btn" id="copySplitAll">
                <i class="fas fa-copy"></i> Copy All
              </button>
            </div>
          </div>

          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-file-code"></i>
              HTML (cleaned from style/script)
            </div>
            <div class="editor-actions">
              <button class="btn" id="toggleSplitHtmlWordWrap">
                <i class="fas fa-text-width"></i>
                Wrap
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="splitHtmlLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="splitHtml" class="editor" readonly></textarea>
            </div>
          </div>

          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-palette"></i>
              CSS
            </div>
            <div class="editor-actions">
              <button class="btn" id="toggleSplitCssWordWrap">
                <i class="fas fa-text-width"></i>
                Wrap
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="splitCssLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="splitCss" class="editor" readonly></textarea>
            </div>
          </div>

          <div class="editor-header">
            <div class="editor-title">
              <i class="fas fa-laptop-code"></i>
              JavaScript
            </div>
            <div class="editor-actions">
              <button class="btn" id="toggleSplitJsWordWrap">
                <i class="fas fa-text-width"></i>
                Wrap
              </button>
            </div>
          </div>
          <div class="editor-wrapper">
            <div class="line-numbers" id="splitJsLineNumbers">1</div>
            <div class="editor-content">
              <textarea id="splitJs" class="editor" readonly></textarea>
            </div>
          </div>
        </div>
      </section>

      <!-- REGEX TESTER -->
      <section class="panel" id="panel-regex" data-tool="regex">
        <div class="editor-container">
          <div class="regex-container">
            <div class="editor-header">
              <div class="editor-title">
                <i class="fas fa-search"></i>
                Regular Expression Tester
              </div>
            </div>
            
            <div class="regex-input-group">
              <input type="text" id="regexPattern" class="regex-input" placeholder="Enter regex pattern (e.g., \d+)" />
              <div class="regex-flags">
                <div class="regex-flag" data-flag="g">g</div>
                <div class="regex-flag" data-flag="i">i</div>
                <div class="regex-flag" data-flag="m">m</div>
                <div class="regex-flag" data-flag="s">s</div>
                <div class="regex-flag" data-flag="u">u</div>
                <div class="regex-flag" data-flag="y">y</div>
              </div>
            </div>
            
            <div class="editor-header">
              <div class="editor-title">
                <i class="fas fa-file-alt"></i>
                Test Text
              </div>
            </div>
            <div class="editor-wrapper">
              <div class="line-numbers" id="regexTestLineNumbers">1</div>
              <div class="editor-content">
                <textarea id="regexTestText" class="editor" placeholder="Enter text to test against the regex pattern...">Hello World 123
Test 456
Another 789 line</textarea>
              </div>
            </div>
            
            <div class="controls">
              <div class="control-group">
                <button class="btn btn-primary" id="testRegex">
                  <i class="fas fa-play"></i>
                  Test Regex
                </button>
                <button class="btn" id="clearRegex">
                  <i class="fas fa-eraser"></i>
                  Clear
                </button>
                <button class="btn" id="copyRegexResult">
                  <i class="fas fa-copy"></i>
                  Copy Result
                </button>
              </div>
            </div>
            
            <div class="editor-header">
              <div class="editor-title">
                <i class="fas fa-code"></i>
                Result
              </div>
            </div>
            <div class="regex-result" id="regexResult">
              <div style="color: var(--text-tertiary);">Enter a regex pattern and click "Test Regex" to see matches highlighted here.</div>
            </div>
            
            <div class="stats">
              <div class="stat-item">
                <i class="fas fa-check-circle"></i>
                <span class="stat-label">Matches:</span>
                <span id="regexMatchCount">0</span>
              </div>
              <div class="stat-item">
                <i class="fas fa-clock"></i>
                <span class="stat-label">Test Time:</span>
                <span id="regexTestTime">0ms</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section class="panel" id="panel-settings" data-tool="settings">
        <div class="editor-container">
          <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-cog"></i> Settings
          </h2>
          <div class="settings-group">
            <h3>
              <i class="fas fa-palette"></i> Appearance
            </h3>
            <div class="settings-control">
              <label for="fontSize">Editor Font Size</label>
              <input type="range" id="fontSize" min="10" max="24" value="14">
              <span id="fontSizeValue" class="range-value">14px</span>
            </div>
            <div class="settings-control">
              <label for="lineNumbersToggle">Show Line Numbers</label>
              <input type="checkbox" id="lineNumbersToggle" checked>
            </div>
            <div class="settings-control">
              <label for="wordWrapToggle">Word Wrap</label>
              <input type="checkbox" id="wordWrapToggle">
            </div>
            <div class="settings-control">
              <label for="autoSaveToggle">Auto Save (5s)</label>
              <input type="checkbox" id="autoSaveToggle" checked>
            </div>
          </div>
          <div class="settings-group">
            <h3>
              <i class="fas fa-database"></i> Data Management
            </h3>
            <div class="control-group">
              <button id="exportSettings" class="btn">
                <i class="fas fa-file-export"></i> Export Settings
              </button>
              <button id="importSettings" class="btn">
                <i class="fas fa-file-import"></i> Import Settings
              </button>
            </div>
          </div>
          <div class="settings-group">
            <h3>
              <i class="fas fa-keyboard"></i> Keyboard Shortcuts
            </h3>
            <div class="shortcuts-container">
              <div class="shortcut-item">
                <span class="shortcut-desc">Save to Local Storage</span>
                <span class="shortcut-key">Ctrl + S</span>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-desc">Load from Local Storage</span>
                <span class="shortcut-key">Ctrl + O</span>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-desc">Find/Replace</span>
                <span class="shortcut-key">Ctrl + F</span>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-desc">Toggle Theme</span>
                <span class="shortcut-key">Ctrl + T</span>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-desc">Copy with Line Numbers</span>
                <span class="shortcut-key">Ctrl + Shift + C</span>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-desc">Reset Current Panel</span>
                <span class="shortcut-key">Ctrl + R</span>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Find/Replace Modal -->
  <div class="find-replace-container" id="findReplaceContainer" style="display: none;">
    <div class="find-replace-header">
      <div class="find-replace-title">Find and Replace</div>
      <div class="find-replace-close" id="closeFindReplace">
        <i class="fas fa-times"></i>
      </div>
    </div>
    <input type="text" id="findInput" class="find-replace-input" placeholder="Find...">
    <input type="text" id="replaceInput" class="find-replace-input" placeholder="Replace with...">
    <div class="find-replace-actions">
      <button class="btn btn-primary" id="findNextBtn">
        <i class="fas fa-arrow-down"></i> Find Next
      </button>
      <button class="btn" id="findPrevBtn">
        <i class="fas fa-arrow-up"></i> Find Prev
      </button>
      <button class="btn btn-success" id="replaceBtn">
        <i class="fas fa-exchange-alt"></i> Replace
      </button>
      <button class="btn btn-success" id="replaceAllBtn">
        <i class="fas fa-exchange-alt"></i> Replace All
      </button>
    </div>
    <div class="find-replace-info" id="findReplaceInfo">Ready</div>
  </div>

  <!-- toast -->
  <div id="toast" class="toast"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
  <script>
    /*
      Code & Text Cleaner Pro - Enhanced Edition
      Features: text utils, code cleaner, html decoder, combine/split, regex tester, find/replace, syntax highlighting, history, theme switcher, keyboard shortcuts
      Author: Thio Saputra / site:flessan.pages.dev
    */

    (() => {
      // --- State Management
      const state = {
        currentTool: 'text',
        theme: 'dark',
        settings: {
          fontSize: 14,
          lineNumbers: true,
          wordWrap: false,
          autoSave: true
        },
        history: [],
        findReplace: {
          isActive: false,
          currentMatch: -1,
          matches: []
        }
      };

      // --- Utility Functions
      const $ = sel => document.querySelector(sel);
      const $$ = sel => Array.from(document.querySelectorAll(sel));
      const saveKey = key => `ctcpro:${key}`;
      const toastEl = $('#toast');
      
      // Toast notification system
      function toast(msg, type = 'info', timeout = 3000) {
        toastEl.textContent = msg;
        toastEl.className = 'toast';
        toastEl.classList.add(type);
        toastEl.classList.remove('hidden');
        setTimeout(() => toastEl.classList.add('show'), 10);
        clearTimeout(toastEl._t);
        toastEl._t = setTimeout(() => {
          toastEl.classList.remove('show');
          setTimeout(() => toastEl.classList.add('hidden'), 250);
        }, timeout);
      }

      // Add to history
      function addToHistory(action, details = '') {
        const historyItem = {
          action,
          details,
          timestamp: new Date().toLocaleTimeString(),
          tool: state.currentTool
        };
        
        state.history.unshift(historyItem);
        if (state.history.length > 20) {
          state.history = state.history.slice(0, 20);
        }
        
        updateHistoryDisplay();
        localStorage.setItem(saveKey('history'), JSON.stringify(state.history));
      }

      // Update history display
      function updateHistoryDisplay() {
        const historyContainer = $(`#${state.currentTool}History`);
        if (!historyContainer) return;
        
        const toolHistory = state.history.filter(item => item.tool === state.currentTool);
        
        if (toolHistory.length === 0) {
          historyContainer.innerHTML = `
            <div class="history-item">
              <div>
                <div class="history-action">No history yet</div>
                <div class="history-time">Start using the tool</div>
              </div>
            </div>
          `;
          return;
        }
        
        historyContainer.innerHTML = toolHistory.map(item => `
          <div class="history-item">
            <div>
              <div class="history-action">${item.action}</div>
              <div class="history-time">${item.timestamp}</div>
            </div>
            <button class="history-restore" data-action="${item.action}" data-details="${item.details}">
              <i class="fas fa-undo"></i>
            </button>
          </div>
        `).join('');
        
        // Add restore handlers
        historyContainer.querySelectorAll('.history-restore').forEach(btn => {
          btn.addEventListener('click', () => {
            const action = btn.dataset.action;
            const details = btn.dataset.details;
            restoreFromHistory(action, details);
          });
        });
      }

      // Restore from history
      function restoreFromHistory(action, details) {
        // Implementation depends on the action
        toast(`Restored: ${action}`, 'success');
      }

      // --- VS Code style activity bar and sidebar
      const activityIcons = $$('.activity-icon');
      const sidebar = $('#sidebar');
      const sidebarClose = $('#sidebarClose');
      
      // Toggle sidebar
      function toggleSidebar() {
        sidebar.classList.toggle('expanded');
      }
      
      // Activity bar click handlers
      activityIcons.forEach(icon => {
        icon.addEventListener('click', () => {
          const tool = icon.dataset.tool;
          switchTool(tool);
        });
      });
      
      // Switch tool
      function switchTool(tool) {
        state.currentTool = tool;
        
        // Update active state
        activityIcons.forEach(i => i.classList.remove('active'));
        $(`.activity-icon[data-tool="${tool}"]`).classList.add('active');
        
        // Update sidebar active tab
        const sidebarTab = $(`.sidebar .tab-btn[data-tool="${tool}"]`);
        if (sidebarTab) {
          $$('.sidebar .tab-btn').forEach(t => t.classList.remove('active'));
          sidebarTab.classList.add('active');
        }
        
        // Show corresponding panel
        $$('.panel').forEach(p => p.classList.toggle('active', p.dataset.tool === tool));
        
        // Update tool title
        const toolTitle = $('#toolTitle');
        const toolName = $(`.activity-icon[data-tool="${tool}"] .tooltip`).textContent;
        const toolIcon = $(`.activity-icon[data-tool="${tool}"] i`).className;
        toolTitle.innerHTML = `<i class="${toolIcon}"></i> ${toolName}`;
        
        // Auto-expand sidebar on desktop
        if (window.innerWidth > 768) {
          sidebar.classList.add('expanded');
        }
        
        // Update history display
        updateHistoryDisplay();
      }
      
      // Sidebar close button
      sidebarClose.addEventListener('click', () => {
        sidebar.classList.remove('expanded');
      });
      
      // Sidebar tab buttons
      $$('.sidebar .tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const tool = btn.dataset.tool;
          switchTool(tool);
        });
      });

      // --- Theme Management
      const themeToggle = $('#themeToggle');
      
      function toggleTheme() {
        const body = document.body;
        const isDark = body.classList.contains('light-theme');
        
        if (isDark) {
          body.classList.remove('light-theme');
          state.theme = 'dark';
          themeToggle.innerHTML = '<i class="fas fa-moon"></i> Theme';
          toast('Switched to dark theme', 'success');
        } else {
          body.classList.add('light-theme');
          state.theme = 'light';
          themeToggle.innerHTML = '<i class="fas fa-sun"></i> Theme';
          toast('Switched to light theme', 'success');
        }
        
        localStorage.setItem(saveKey('theme'), state.theme);
      }
      
      themeToggle.addEventListener('click', toggleTheme);
      
      // Load saved theme
      const savedTheme = localStorage.getItem(saveKey('theme'));
      if (savedTheme === 'light') {
        document.body.classList.add('light-theme');
        state.theme = 'light';
        themeToggle.innerHTML = '<i class="fas fa-sun"></i> Theme';
      }

      // --- Line numbers functionality
      function updateLineNumbers(textarea, lineNumbersId) {
        const lineNumbers = $(lineNumbersId);
        if (!lineNumbers) return;
        
        const lines = textarea.value.split('\n').length;
        let numbers = '';
        for (let i = 1; i <= lines; i++) {
          numbers += i + '\n';
        }
        lineNumbers.textContent = numbers;
        
        // Adjust width based on number of digits
        const digitCount = lines.toString().length;
        const width = Math.max(50, digitCount * 10 + 20);
        lineNumbers.style.width = width + 'px';
        
        // Adjust padding of editor content
        const editorContent = lineNumbers.nextElementSibling;
        if (editorContent) {
          editorContent.style.paddingLeft = width + 'px';
        }
      }

      // Setup line numbers for all textareas
      const textareas = $$('textarea.editor');
      const panels = $$('.panel');
      
      textareas.forEach(textarea => {
        const lineNumbersId = textarea.id + 'LineNumbers';
        const lineNumbers = $(lineNumbersId);
        
        if (lineNumbers) {
          // Initial update
          updateLineNumbers(textarea, lineNumbersId);
          
          // Update on input
          textarea.addEventListener('input', () => {
            updateLineNumbers(textarea, lineNumbersId);
          });
          
          // Sync scroll
          textarea.addEventListener('scroll', () => {
            lineNumbers.scrollTop = textarea.scrollTop;
          });
        }
      });

      // --- Find and Replace functionality
      const findReplaceBtn = $('#findReplaceBtn');
      const findReplaceContainer = $('#findReplaceContainer');
      const closeFindReplace = $('#closeFindReplace');
      const findInput = $('#findInput');
      const replaceInput = $('#replaceInput');
      const findNextBtn = $('#findNextBtn');
      const findPrevBtn = $('#findPrevBtn');
      const replaceBtn = $('#replaceBtn');
      const replaceAllBtn = $('#replaceAllBtn');
      const findReplaceInfo = $('#findReplaceInfo');
      
      let currentEditor = null;
      
      function showFindReplace() {
        findReplaceContainer.style.display = 'block';
        findInput.focus();
        state.findReplace.isActive = true;
        
        // Set current editor based on active panel
        const activePanel = $('.panel.active');
        if (activePanel) {
          const editor = activePanel.querySelector('textarea.editor:not([readonly])');
          if (editor) {
            currentEditor = editor;
          }
        }
      }
      
      function hideFindReplace() {
        findReplaceContainer.style.display = 'none';
        state.findReplace.isActive = false;
        clearHighlights();
      }
      
      function findInEditor(direction = 'next') {
        if (!currentEditor || !findInput.value) return;
        
        const searchText = findInput.value;
        const text = currentEditor.value;
        const currentIndex = currentEditor.selectionStart;
        
        let matchIndex = -1;
        
        if (direction === 'next') {
          matchIndex = text.indexOf(searchText, currentIndex);
          if (matchIndex === -1) {
            matchIndex = text.indexOf(searchText); // Wrap around
          }
        } else {
          matchIndex = text.lastIndexOf(searchText, currentIndex - 1);
          if (matchIndex === -1) {
            matchIndex = text.lastIndexOf(searchText); // Wrap around
          }
        }
        
        if (matchIndex !== -1) {
          currentEditor.focus();
          currentEditor.setSelectionRange(matchIndex, matchIndex + searchText.length);
          currentEditor.scrollTop = currentEditor.scrollTop + 
            (matchIndex - currentEditor.selectionStart) * parseInt(getComputedStyle(currentEditor).lineHeight);
          
          findReplaceInfo.textContent = `Found match at position ${matchIndex}`;
          addToHistory('Find', `"${searchText}"`);
        } else {
          findReplaceInfo.textContent = 'No matches found';
        }
      }
      
      function replaceInEditor() {
        if (!currentEditor || !findInput.value) return;
        
        const searchText = findInput.value;
        const replaceText = replaceInput.value;
        const selectionStart = currentEditor.selectionStart;
        const selectionEnd = currentEditor.selectionEnd;
        const selectedText = currentEditor.value.substring(selectionStart, selectionEnd);
        
        if (selectedText === searchText) {
          const before = currentEditor.value.substring(0, selectionStart);
          const after = currentEditor.value.substring(selectionEnd);
          currentEditor.value = before + replaceText + after;
          
          // Update cursor position
          const newCursorPos = selectionStart + replaceText.length;
          currentEditor.setSelectionRange(newCursorPos, newCursorPos);
          
          findReplaceInfo.textContent = 'Replaced 1 occurrence';
          addToHistory('Replace', `"${searchText}"  "${replaceText}"`);
        } else {
          findReplaceInfo.textContent = 'No match at cursor position';
        }
      }
      
      function replaceAllInEditor() {
        if (!currentEditor || !findInput.value) return;
        
        const searchText = findInput.value;
        const replaceText = replaceInput.value;
        const regex = new RegExp(escapeRegExp(searchText), 'g');
        const originalValue = currentEditor.value;
        const newValue = originalValue.replace(regex, replaceText);
        
        if (originalValue !== newValue) {
          currentEditor.value = newValue;
          const matchCount = (originalValue.match(regex) || []).length;
          findReplaceInfo.textContent = `Replaced ${matchCount} occurrences`;
          addToHistory('Replace All', `"${searchText}"  "${replaceText}" (${matchCount} times)`);
        } else {
          findReplaceInfo.textContent = 'No matches found';
        }
      }
      
      function escapeRegExp(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      }
      
      function clearHighlights() {
        // Implementation for clearing search highlights
      }
      
      findReplaceBtn.addEventListener('click', showFindReplace);
      closeFindReplace.addEventListener('click', hideFindReplace);
      findNextBtn.addEventListener('click', () => findInEditor('next'));
      findPrevBtn.addEventListener('click', () => findInEditor('prev'));
      replaceBtn.addEventListener('click', replaceInEditor);
      replaceAllBtn.addEventListener('click', replaceAllInEditor);
      
      // Keyboard shortcuts for find/replace
      findInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          if (e.shiftKey) {
            findInEditor('prev');
          } else {
            findInEditor('next');
          }
        } else if (e.key === 'Escape') {
          hideFindReplace();
        }
      });
      
      replaceInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          replaceInEditor();
        } else if (e.key === 'Escape') {
          hideFindReplace();
        }
      });

      // --- Copy with line numbers
      function copyWithLineNumbers(textareaId) {
        const textarea = $(textareaId);
        if (!textarea) return;
        
        const lines = textarea.value.split('\n');
        const textWithNumbers = lines.map((line, index) => `${index + 1}: ${line}`).join('\n');
        
        navigator.clipboard.writeText(textWithNumbers).then(() => {
          toast('Copied with line numbers', 'success');
          addToHistory('Copy', 'With line numbers');
        }).catch(err => {
          toast('Failed to copy: ' + err.message, 'error');
        });
      }
      
      $('#copyWithLineNumbers').addEventListener('click', () => copyWithLineNumbers('inputText'));
      $('#copyCodeWithLineNumbers').addEventListener('click', () => copyWithLineNumbers('codeInput'));

      // --- TEXT TOOLS
      const inputText = $('#inputText');
      const outputText = $('#outputText');
      const wordCount = $('#wordCount');
      const charCount = $('#charCount');
      const lineCount = $('#lineCount');
      const detailedStats = $('#detailedStats');
      
      function updateCounts(txt) {
        const chars = txt.length;
        const words = (txt.trim().match(/\S+/g) || []).length;
        const lines = txt.split('\n').length;
        const sentences = (txt.match(/[.!?]+/g) || []).length;
        const paragraphs = (txt.match(/\n\s*\n/g) || []).length + 1;
        const uniqueWords = new Set(txt.toLowerCase().match(/\b\w+\b/g) || []).size;
        const readingTime = Math.ceil(words / 200); // Average reading speed: 200 words per minute
        
        charCount.textContent = chars;
        wordCount.textContent = words;
        lineCount.textContent = lines;
        
        // Update detailed stats
        if (words > 0) {
          detailedStats.style.display = 'grid';
          $('#sentenceCount').textContent = sentences;
          $('#paragraphCount').textContent = paragraphs;
          $('#readingTime').textContent = readingTime + ' min';
          $('#uniqueWords').textContent = uniqueWords;
        } else {
          detailedStats.style.display = 'none';
        }
      }

      function transformText(action) {
        let t = inputText.value;
        let actionName = action;
        
        switch (action) {
          case 'lower':
            t = t.toLowerCase();
            break;
          case 'upper':
            t = t.toUpperCase();
            break;
          case 'title':
            t = t.replace(/\w\S*/g, w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase());
            break;
          case 'trimspaces':
            t = t.replace(/[ \t]{2,}/g, ' ');
            break;
          case 'trimlines':
            t = t.split('\n').filter(l => l.trim() !== '').join('\n');
            break;
          case 'reverse':
            t = t.split('').reverse().join('');
            break;
          case 'sort':
            t = t.split('\n').sort().join('\n');
            break;
          case 'dedupe':
            t = [...new Set(t.split('\n'))].join('\n');
            break;
        }
        
        outputText.value = t;
        updateCounts(t);
        toast('Transformation complete', 'success');
        addToHistory(actionName);
      }

      document.querySelectorAll('[data-action]').forEach(btn => {
        btn.addEventListener('click', () => transformText(btn.dataset.action));
      });

      // Case conversion
      document.querySelectorAll('[data-case]').forEach(btn => {
        btn.addEventListener('click', () => {
          const caseType = btn.dataset.case;
          const text = inputText.value;
          let result = '';
          
          switch (caseType) {
            case 'camel':
              result = text.replace(/(?:^\w|[A-Z]|\b\w)/g, (word, index) => {
                return index === 0 ? word.toLowerCase() : word.toUpperCase();
              }).replace(/\s+/g, '');
              break;
            case 'pascal':
              result = text.replace(/(?:^\w|[A-Z]|\b\w)/g, word => word.toUpperCase()).replace(/\s+/g, '');
              break;
            case 'snake':
              result = text.replace(/\s+/g, '_').toLowerCase();
              break;
            case 'kebab':
              result = text.replace(/\s+/g, '-').toLowerCase();
              break;
            case 'constant':
              result = text.replace(/\s+/g, '_').toUpperCase();
              break;
            case 'dot':
              result = text.replace(/\s+/g, '.').toLowerCase();
              break;
          }
          
          outputText.value = result;
          updateCounts(result);
          toast(`Converted to ${caseType} case`, 'success');
          addToHistory('Case Conversion', caseType);
        });
      });

      inputText.addEventListener('input', e => {
        updateCounts(inputText.value);
      });

      $('#copyOutput').addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(outputText.value || inputText.value);
          toast('Copied to clipboard', 'success');
          addToHistory('Copy', 'Output text');
        } catch (e) {
          toast('Failed to copy: ' + (e.message || e), 'error');
        }
      });

      $('#downloadTxt').addEventListener('click', () => {
        const txt = outputText.value || inputText.value;
        if (!txt) return toast('No text to download', 'warning');
        downloadBlob(txt, 'text/plain', 'output.txt');
        toast('Downloading output.txt', 'success');
        addToHistory('Download', 'Text file');
      });

      // Syntax highlighting
      $('#syntaxHighlight').addEventListener('click', () => {
        const text = outputText.value || inputText.value;
        if (!text) return toast('No text to highlight', 'warning');
        
        // Determine language
        let language = 'text';
        const sample = text.slice(0, 200).toLowerCase();
        if (sample.includes('<html') || sample.includes('<!doctype') || sample.includes('<div')) {
          language = 'markup';
        } else if (sample.includes('{') && sample.includes('}') && sample.includes('function')) {
          language = 'javascript';
        } else if (sample.includes('{') && sample.includes('color') || sample.includes('.class')) {
          language = 'css';
        } else if (sample.includes('{') && sample.includes('}')) {
          try {
            JSON.parse(text);
            language = 'json';
          } catch (e) {
            // Not JSON
          }
        }
        
        const highlighted = Prism.highlight(text, Prism.languages[language], language);
        const highlightedDiv = document.createElement('div');
        highlightedDiv.className = 'syntax-highlighted';
        highlightedDiv.innerHTML = `<pre><code class="language-${language}">${highlighted}</code></pre>`;
        
        // Replace output textarea with highlighted version
        const outputWrapper = outputText.parentElement;
        outputWrapper.innerHTML = '';
        outputWrapper.appendChild(highlightedDiv);
        
        toast('Syntax highlighting applied', 'success');
        addToHistory('Syntax Highlight', language);
      });

      // prettify JSON
      $('#prettyJson').addEventListener('click', () => {
        const s = inputText.value.trim();
        if (!s) return toast('Enter JSON in input', 'warning');
        try {
          const obj = JSON.parse(s);
          outputText.value = JSON.stringify(obj, null, 2);
          updateCounts(outputText.value);
          toast('JSON prettified successfully', 'success');
          addToHistory('JSON', 'Prettify');
        } catch (e) {
          toast('Invalid JSON: ' + e.message, 'error');
        }
      });

      // minify JSON
      $('#minifyJson').addEventListener('click', () => {
        const s = inputText.value.trim();
        if (!s) return toast('Enter JSON in input', 'warning');
        try {
          const obj = JSON.parse(s);
          outputText.value = JSON.stringify(obj);
          updateCounts(outputText.value);
          toast('JSON minified successfully', 'success');
          addToHistory('JSON', 'Minify');
        } catch (e) {
          toast('Invalid JSON: ' + e.message, 'error');
        }
      });

      // Base64 encode
      $('#base64Encode').addEventListener('click', () => {
        const s = inputText.value.trim();
        if (!s) return toast('Enter text to encode', 'warning');
        try {
          outputText.value = btoa(unescape(encodeURIComponent(s)));
          updateCounts(outputText.value);
          toast('Text encoded to Base64', 'success');
          addToHistory('Base64', 'Encode');
        } catch (e) {
          toast('Encoding failed: ' + e.message, 'error');
        }
      });

      // Base64 decode
      $('#base64Decode').addEventListener('click', () => {
        const s = inputText.value.trim();
        if (!s) return toast('Enter Base64 to decode', 'warning');
        try {
          outputText.value = decodeURIComponent(escape(atob(s)));
          updateCounts(outputText.value);
          toast('Base64 decoded successfully', 'success');
          addToHistory('Base64', 'Decode');
        } catch (e) {
          toast('Invalid Base64: ' + e.message, 'error');
        }
      });

      // URL encode
      $('#urlEncode').addEventListener('click', () => {
        const s = inputText.value.trim();
        if (!s) return toast('Enter text to encode', 'warning');
        try {
          outputText.value = encodeURIComponent(s);
          updateCounts(outputText.value);
          toast('Text URL encoded', 'success');
          addToHistory('URL', 'Encode');
        } catch (e) {
          toast('Encoding failed: ' + e.message, 'error');
        }
      });

      // URL decode
      $('#urlDecode').addEventListener('click', () => {
        const s = inputText.value.trim();
        if (!s) return toast('Enter URL to decode', 'warning');
        try {
          outputText.value = decodeURIComponent(s);
          updateCounts(outputText.value);
          toast('URL decoded', 'success');
          addToHistory('URL', 'Decode');
        } catch (e) {
          toast('Invalid URL encoding: ' + e.message, 'error');
        }
      });

      // Paste functionality
      $('#pasteText').addEventListener('click', async () => {
        try {
          const text = await navigator.clipboard.readText();
          inputText.value = text;
          updateCounts(text);
          toast('Text pasted from clipboard', 'success');
          addToHistory('Paste', 'From clipboard');
        } catch (e) {
          toast('Failed to paste: ' + e.message, 'error');
        }
      });

      // save/load/reset (localStorage)
      $('#saveLocal').addEventListener('click', () => {
        localStorage.setItem(saveKey('text:input'), inputText.value);
        localStorage.setItem(saveKey('text:output'), outputText.value);
        toast('Saved to localStorage', 'success');
        addToHistory('Save', 'To localStorage');
      });

      $('#loadLocal').addEventListener('click', () => {
        const a = localStorage.getItem(saveKey('text:input')) || '';
        const b = localStorage.getItem(saveKey('text:output')) || '';
        inputText.value = a;
        outputText.value = b;
        updateCounts(inputText.value || outputText.value);
        toast('Loaded from localStorage', 'success');
        addToHistory('Load', 'From localStorage');
      });

      $('#reset').addEventListener('click', () => {
        if (!confirm('Reset all areas?')) return;
        inputText.value = '';
        outputText.value = '';
        updateCounts('');
        toast('Reset complete', 'success');
        addToHistory('Reset', 'All areas');
      });

      // autosave
      let autoSaveInterval;
      function setupAutoSave() {
        if (autoSaveInterval) clearInterval(autoSaveInterval);
        
        if (state.settings.autoSave) {
          autoSaveInterval = setInterval(() => {
            localStorage.setItem(saveKey('text:auto'), inputText.value);
          }, 5000);
        }
      }

      setupAutoSave();

      const autosaved = localStorage.getItem(saveKey('text:auto'));
      if (autosaved) {
        inputText.value = autosaved;
        updateCounts(autosaved);
      }

      // --- drag & drop for text
      const textDrop = $('#textDrop');
      
      function setupDrop(zone, targetTextarea, allowed = ['txt', 'md', 'json']) {
        zone.addEventListener('dragover', e => {
          e.preventDefault();
          zone.classList.add('dragover');
        });
        
        zone.addEventListener('dragleave', e => {
          zone.classList.remove('dragover');
        });
        
        zone.addEventListener('drop', async e => {
          e.preventDefault();
          zone.classList.remove('dragover');
          const f = e.dataTransfer.files && e.dataTransfer.files[0];
          if (!f) return;
          const ext = f.name.split('.').pop().toLowerCase();
          if (!allowed.includes(ext) && allowed.length) return toast('File type not supported: ' + ext, 'error');
          
          try {
            const text = await f.text();
            targetTextarea.value = text;
            if (targetTextarea === inputText) {
              updateCounts(text);
            }
            toast('File loaded: ' + f.name, 'success');
            addToHistory('File Load', f.name);
          } catch (err) {
            toast('Failed to load file: ' + err.message, 'error');
          }
        });
        
        zone.addEventListener('click', () => {
          const input = document.createElement('input');
          input.type = 'file';
          input.accept = allowed.map(ext => '.' + ext).join(',');
          input.onchange = async e => {
            const f = e.target.files[0];
            if (!f) return;
            const ext = f.name.split('.').pop().toLowerCase();
            if (!allowed.includes(ext) && allowed.length) return toast('File type not supported: ' + ext, 'error');
            
            try {
              const text = await f.text();
              targetTextarea.value = text;
              if (targetTextarea === inputText) {
                updateCounts(text);
              }
              toast('File loaded: ' + f.name, 'success');
              addToHistory('File Load', f.name);
            } catch (err) {
              toast('Failed to load file: ' + err.message, 'error');
            }
          };
          input.click();
        });
      }
      
      setupDrop(textDrop, inputText, ['txt', 'md', 'json']);

      // --- CODE CLEANER
      const codeInput = $('#codeInput');
      const codeOutput = $('#codeOutput');
      
      function removeCommentsCSSJS(s) {
        s = s.replace(/\/\*[\s\S]*?\*\//g, '');
        s = s.replace(/(^|\n)\s*\/\/.*$/gm, '');
        return s;
      }
      
      function minifyHTML(html) {
        html = html.replace(/<!--[\s\S]*?-->/g, '');
        html = html.replace(/\s{2,}/g, ' ');
        html = html.replace(/>\s+</g, '><');
        return html.trim();
      }
      
      function cleanCSS(s) {
        s = removeCommentsCSSJS(s);
        s = s.replace(/\s+/g, ' ');
        return s.trim();
      }
      
      function cleanJS(s) {
        s = removeCommentsCSSJS(s);
        s = s.replace(/\n\s*/g, '\n');
        return s.trim();
      }
      
      function formatHTMLbasic(s) {
        return s.replace(/>\s*</g, '>\n<').replace(/\n\s+/g, '\n').trim();
      }
      
      function formatCSS(css) {
        css = css.replace(/}/g, '}\n');
        css = css.replace(/{/g, ' {\n  ');
        css = css.replace(/;/g, ';\n  ');
        css = css.replace(/\n\s+\n/g, '\n');
        return css.trim();
      }
      
      function formatJS(js) {
        js = js.replace(/{/g, ' {\n  ');
        js = js.replace(/}/g, '\n}');
        js = js.replace(/;/g, ';\n');
        return js.trim();
      }

      $('[data-code-action]').forEach(btn => {
        btn.addEventListener('click', () => {
          const act = btn.dataset.codeAction;
          let src = codeInput.value;
          let out = '';
          let actionName = '';
          
          switch (act) {
            case 'minify-html':
              out = minifyHTML(src);
              actionName = 'Minify HTML';
              break;
            case 'minify-css':
              out = cleanCSS(src);
              actionName = 'Minify CSS';
              break;
            case 'minify-js':
              out = cleanJS(src);
              actionName = 'Minify JS';
              break;
            case 'remove-comments':
              out = removeCommentsCSSJS(src);
              actionName = 'Remove Comments';
              break;
          }
          
          codeOutput.value = out;
          toast('Operation completed: ' + actionName, 'success');
          addToHistory('Code Cleaner', actionName);
        });
      });

      $('#formatHtml').addEventListener('click', () => {
        codeOutput.value = formatHTMLbasic(codeInput.value);
        toast('HTML formatted (basic)', 'success');
        addToHistory('Code Cleaner', 'Format HTML');
      });

      $('#formatCss').addEventListener('click', () => {
        codeOutput.value = formatCSS(codeInput.value);
        toast('CSS formatted', 'success');
        addToHistory('Code Cleaner', 'Format CSS');
      });

      $('#formatJs').addEventListener('click', () => {
        codeOutput.value = formatJS(codeInput.value);
        toast('JavaScript formatted', 'success');
        addToHistory('Code Cleaner', 'Format JS');
      });

      $('#beautifyJson').addEventListener('click', () => {
        const s = codeInput.value.trim();
        if (!s) return toast('Enter JSON in input', 'warning');
        try {
          const obj = JSON.parse(s);
          codeOutput.value = JSON.stringify(obj, null, 2);
          toast('JSON beautified successfully', 'success');
          addToHistory('Code Cleaner', 'Beautify JSON');
        } catch (e) {
          toast('Invalid JSON: ' + e.message, 'error');
        }
      });

      $('#copyCode').addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(codeOutput.value || codeInput.value);
          toast('Copied to clipboard', 'success');
          addToHistory('Copy', 'Code output');
        } catch (e) {
          toast('Failed to copy: ' + e.message, 'error');
        }
      });

      $('#downloadCode').addEventListener('click', () => {
        const txt = codeOutput.value || codeInput.value;
        if (!txt) return toast('No code to download', 'warning');
        
        // try to guess extension
        let ext = 'txt';
        const sample = txt.slice(0, 200).toLowerCase();
        if (sample.includes('<html') || sample.includes('<!doctype')) ext = 'html';
        else if (sample.includes('{') && sample.includes('}')) ext = 'js';
        else if (sample.includes('{') && sample.includes('color')) ext = 'css';
        
        downloadBlob(txt, 'text/plain', `code.${ext}`);
        toast('Downloading code.' + ext, 'success');
        addToHistory('Download', `Code file (.${ext})`);
      });

      // Paste functionality for code
      $('#pasteCode').addEventListener('click', async () => {
        try {
          const text = await navigator.clipboard.readText();
          codeInput.value = text;
          toast('Code pasted from clipboard', 'success');
          addToHistory('Paste', 'Code from clipboard');
        } catch (e) {
          toast('Failed to paste: ' + e.message, 'error');
        }
      });

      // drag & drop for code files
      const codeDrop = $('#codeDrop');
      setupDrop(codeDrop, codeInput, ['html', 'css', 'js', 'txt']);

      // preview iframe for code
      $('#previewCode').addEventListener('click', () => {
        const src = codeOutput.value || codeInput.value;
        if (!src) return toast('No code to preview', 'warning');
        
        const previewWrap = $('#previewWrap');
        const iframe = $('#previewFrame');
        
        // if html fragment, wrap minimal
        let doc = src;
        if (!/<html/i.test(src)) {
          doc = `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"></head><body>${src}</body></html>`;
        }
        
        iframe.srcdoc = doc;
        previewWrap.classList.remove('hidden');
        toast('Preview ready', 'success');
        addToHistory('Preview', 'Code preview');
      });

      $('#refreshPreview').addEventListener('click', () => {
        const src = codeOutput.value || codeInput.value;
        if (!src) return toast('No code to preview', 'warning');
        
        const iframe = $('#previewFrame');
        let doc = src;
        if (!/<html/i.test(src)) {
          doc = `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"></head><body>${src}</body></html>`;
        }
        
        iframe.srcdoc = doc;
        toast('Preview refreshed', 'success');
      });

      $('#closePreview').addEventListener('click', () => {
        $('#previewWrap').classList.add('hidden');
        $('#previewFrame').srcdoc = 'about:blank';
      });

      // --- HTML ENTITY DECODER / ENCODER
      const encoded = $('#encoded');
      const decoded = $('#decoded');
      
      $('#decodeBtn').addEventListener('click', () => {
        decoded.value = decodeHTMLEntities(encoded.value);
        toast('Decode complete', 'success');
        addToHistory('HTML Decoder', 'Decode entities');
      });
      
      $('#encodeBtn').addEventListener('click', () => {
        encoded.value = encodeHTMLEntities(decoded.value || encoded.value);
        toast('Encode complete', 'success');
        addToHistory('HTML Decoder', 'Encode entities');
      });
      
      $('#copyDecoded').addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(decoded.value);
          toast('Copied to clipboard', 'success');
          addToHistory('Copy', 'Decoded text');
        } catch (e) {
          toast('Failed to copy: ' + e.message, 'error');
        }
      });
      
      $('#autoDetectEntities').addEventListener('click', () => {
        const v = encoded.value;
        if (/&[a-z0-9]+;/.test(v) || /&lt;|&gt;|&amp;/.test(v)) {
          decoded.value = decodeHTMLEntities(v);
          toast('Entities detected and decoded', 'success');
          addToHistory('HTML Decoder', 'Auto-detect & decode');
        } else {
          toast('No HTML entities found in input', 'warning');
        }
      });
      
      function decodeHTMLEntities(text) {
        const txt = document.createElement('textarea');
        txt.innerHTML = text;
        return txt.value;
      }
      
      function encodeHTMLEntities(text) {
        const txt = document.createElement('textarea');
        txt.textContent = text;
        return txt.innerHTML;
      }

      // --- COMBINE
      const combineHtml = $('#combineHtml');
      const combineCss = $('#combineCss');
      const combineJs = $('#combineJs');
      const combinedOutput = $('#combinedOutput');
      
      $('#combineBtn').addEventListener('click', () => {
        const htmlRaw = combineHtml.value || '<!doctype html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<meta name="viewport" content="width=device-width,initial-scale=1"/>\n<title>Combined</title>\n</head>\n<body>\n</body>\n</html>';
        let doc;
        
        try {
          if (/<html/i.test(htmlRaw)) {
            doc = htmlRaw;
            
            if (combineCss.value.trim()) {
              if (/<\/head>/i.test(doc)) {
                doc = doc.replace(/<\/head>/i, `  <style>\n${combineCss.value}\n  </style>\n</head>`);
              } else {
                doc = doc.replace(/<body.*?>/i, `<head><style>\n${combineCss.value}\n</style></head></body>`);
              }
            }
            
            if (combineJs.value.trim()) {
              if (/<\/body>/i.test(doc)) {
                doc = doc.replace(/<\/body>/i, `  <script>\n${combineJs.value}\n  </script>\n</body>`);
              } else {
                doc += `\n<script>\n${combineJs.value}\n</script>`;
              }
            }
          } else {
            doc = `<!doctype html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<meta name="viewport" content="width=device-width,initial-scale=1"/>\n<title>Combined</title>\n<style>\n${combineCss.value}\n</style>\n</head>\n<body>\n${htmlRaw}\n<script>\n${combineJs.value}\n</script>\n</body>\n</html>`;
          }
        } catch (e) {
          doc = htmlRaw;
        }
        
        combinedOutput.value = doc;
        toast('Combine complete', 'success');
        addToHistory('Combine', 'HTML/CSS/JS');
      });

      $('#copyCombined').addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(combinedOutput.value);
          toast('Combined code copied', 'success');
          addToHistory('Copy', 'Combined HTML');
        } catch (e) {
          toast('Failed to copy: ' + e.message, 'error');
        }
      });

      $('#downloadCombined').addEventListener('click', () => {
        const html = combinedOutput.value;
        if (!html) return toast('No combined code to download', 'warning');
        downloadBlob(html, 'text/html', 'combined.html');
        toast('Downloading combined.html', 'success');
        addToHistory('Download', 'Combined HTML');
      });

      // combined preview
      $('#previewCombined').addEventListener('click', () => {
        const html = combinedOutput.value;
        if (!html) return toast('No combined code to preview', 'warning');
        
        const wrap = $('#previewCombinedWrap');
        const ifr = $('#previewCombined');
        ifr.srcdoc = html;
        wrap.classList.remove('hidden');
        toast('Combined preview ready', 'success');
        addToHistory('Preview', 'Combined HTML');
      });

      $('#refreshCombinedPreview').addEventListener('click', () => {
        const html = combinedOutput.value;
        if (!html) return toast('No combined code to preview', 'warning');
        
        const ifr = $('#previewCombined');
        ifr.srcdoc = html;
        toast('Combined preview refreshed', 'success');
      });

      $('#closeCombinedPreview').addEventListener('click', () => {
        $('#previewCombinedWrap').classList.add('hidden');
        $('#previewCombined').srcdoc = 'about:blank';
      });

      // --- SPLIT
      const splitInput = $('#splitInput');
      const splitHtml = $('#splitHtml');
      const splitCss = $('#splitCss');
      const splitJs = $('#splitJs');
      
      $('#splitBtn').addEventListener('click', () => {
        const src = splitInput.value;
        if (!src) return toast('Enter HTML containing <style> / <script>', 'warning');
        
        const styleMatches = [...src.matchAll(/<style[^>]*>([\s\S]*?)<\/style>/gi)];
        const scriptMatches = [...src.matchAll(/<script[^>]*>([\s\S]*?)<\/script>/gi)];
        
        let css = styleMatches.map(m => m[1]).join('\n\n').trim();
        let js = scriptMatches.map(m => m[1]).join('\n\n').trim();
        let htmlClean = src.replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '').replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '');
        
        splitCss.value = css;
        splitJs.value = js;
        splitHtml.value = htmlClean.trim();
        toast('Split complete', 'success');
        addToHistory('Split', 'HTML into parts');
      });

      $('#downloadHtml').addEventListener('click', () => {
        const t = splitHtml.value;
        if (!t) return toast('No HTML to download', 'warning');
        downloadBlob(t, 'text/html', 'split.html');
        toast('Downloading split.html', 'success');
        addToHistory('Download', 'Split HTML');
      });

      $('#downloadCss').addEventListener('click', () => {
        const t = splitCss.value;
        if (!t) return toast('No CSS to download', 'warning');
        downloadBlob(t, 'text/css', 'styles.css');
        toast('Downloading styles.css', 'success');
        addToHistory('Download', 'Split CSS');
      });

      $('#downloadJs').addEventListener('click', () => {
        const t = splitJs.value;
        if (!t) return toast('No JavaScript to download', 'warning');
        downloadBlob(t, 'application/javascript', 'script.js');
        toast('Downloading script.js', 'success');
        addToHistory('Download', 'Split JS');
      });

      $('#copySplitAll').addEventListener('click', async () => {
        const combined = `HTML:\n${splitHtml.value}\n\nCSS:\n${splitCss.value}\n\nJS:\n${splitJs.value}`;
        try {
          await navigator.clipboard.writeText(combined);
          toast('All parts copied', 'success');
          addToHistory('Copy', 'All split parts');
        } catch (e) {
          toast('Failed to copy: ' + e.message, 'error');
        }
      });

      // --- REGEX TESTER
      const regexPattern = $('#regexPattern');
      const regexTestText = $('#regexTestText');
      const regexResult = $('#regexResult');
      const regexMatchCount = $('#regexMatchCount');
      const regexTestTime = $('#regexTestTime');
      const regexFlags = $$('.regex-flag');
      
      let selectedFlags = new Set();
      
      // Toggle regex flags
      regexFlags.forEach(flag => {
        flag.addEventListener('click', () => {
          const flagValue = flag.dataset.flag;
          if (selectedFlags.has(flagValue)) {
            selectedFlags.delete(flagValue);
            flag.classList.remove('active');
          } else {
            selectedFlags.add(flagValue);
            flag.classList.add('active');
          }
        });
      });
      
      $('#testRegex').addEventListener('click', () => {
        const pattern = regexPattern.value;
        const text = regexTestText.value;
        
        if (!pattern) {
          toast('Please enter a regex pattern', 'warning');
          return;
        }
        
        const startTime = performance.now();
        
        try {
          const flags = Array.from(selectedFlags).join('');
          const regex = new RegExp(pattern, flags);
          const matches = text.match(regex);
          
          const endTime = performance.now();
          const testTime = (endTime - startTime).toFixed(2);
          
          // Highlight matches
          let highlightedText = text;
          if (matches) {
            matches.forEach(match => {
              highlightedText = highlightedText.replace(
                new RegExp(escapeRegExp(match), 'g'),
                '<span class="regex-match">$&</span>'
              );
            });
          }
          
          regexResult.innerHTML = highlightedText || '<div style="color: var(--text-tertiary);">No matches found</div>';
          regexMatchCount.textContent = matches ? matches.length : 0;
          regexTestTime.textContent = testTime + 'ms';
          
          toast('Regex test completed', 'success');
          addToHistory('Regex Test', pattern);
        } catch (e) {
          regexResult.innerHTML = `<div style="color: var(--accent-danger);">Invalid regex: ${e.message}</div>`;
          regexMatchCount.textContent = '0';
          regexTestTime.textContent = '0ms';
          toast('Invalid regex pattern', 'error');
        }
      });
      
      $('#clearRegex').addEventListener('click', () => {
        regexPattern.value = '';
        regexTestText.value = '';
        regexResult.innerHTML = '<div style="color: var(--text-tertiary);">Enter a regex pattern and click "Test Regex" to see matches highlighted here.</div>';
        regexMatchCount.textContent = '0';
        regexTestTime.textContent = '0ms';
        selectedFlags.clear();
        regexFlags.forEach(flag => flag.classList.remove('active'));
        toast('Regex tester cleared', 'success');
      });
      
      $('#copyRegexResult').addEventListener('click', async () => {
        try {
          const resultText = regexResult.innerText;
          await navigator.clipboard.writeText(resultText);
          toast('Regex result copied', 'success');
          addToHistory('Copy', 'Regex result');
        } catch (e) {
          toast('Failed to copy: ' + e.message, 'error');
        }
      });

      // --- SETTINGS
      // Font size control
      const fontSizeInput = $('#fontSize');
      const fontSizeValue = $('#fontSizeValue');
      
      fontSizeInput.addEventListener('input', (e) => {
        const size = e.target.value;
        fontSizeValue.textContent = size + 'px';
        document.documentElement.style.setProperty('--editor-font-size', size + 'px');
        state.settings.fontSize = parseInt(size);
        localStorage.setItem(saveKey('settings'), JSON.stringify(state.settings));
      });
      
      // Line numbers toggle
      const lineNumbersToggle = $('#lineNumbersToggle');
      
      lineNumbersToggle.addEventListener('change', (e) => {
        const show = e.target.checked;
        $$('.line-numbers').forEach(el => {
          el.style.display = show ? 'block' : 'none';
        });
        
        $$('.editor-content').forEach(el => {
          if (show) {
            el.classList.remove('no-line-numbers');
          } else {
            el.classList.add('no-line-numbers');
          }
        });
        
        state.settings.lineNumbers = show;
        localStorage.setItem(saveKey('settings'), JSON.stringify(state.settings));
      });
      
      // Word wrap toggle
      const wordWrapToggle = $('#wordWrapToggle');
      
      wordWrapToggle.addEventListener('change', (e) => {
        const wrap = e.target.checked;
        textareas.forEach(textarea => {
          if (wrap) {
            textarea.classList.add('word-wrap');
          } else {
            textarea.classList.remove('word-wrap');
          }
        });
        state.settings.wordWrap = wrap;
        localStorage.setItem(saveKey('settings'), JSON.stringify(state.settings));
      });
      
      // Auto save toggle
      const autoSaveToggle = $('#autoSaveToggle');
      
      autoSaveToggle.addEventListener('change', (e) => {
        state.settings.autoSave = e.target.checked;
        localStorage.setItem(saveKey('settings'), JSON.stringify(state.settings));
        setupAutoSave();
        toast(state.settings.autoSave ? 'Auto save enabled' : 'Auto save disabled', 'success');
      });
      
      // Load saved settings
      const savedSettings = localStorage.getItem(saveKey('settings'));
      if (savedSettings) {
        try {
          const settings = JSON.parse(savedSettings);
          state.settings = { ...state.settings, ...settings };
          
          // Apply settings
          fontSizeInput.value = state.settings.fontSize;
          fontSizeValue.textContent = state.settings.fontSize + 'px';
          document.documentElement.style.setProperty('--editor-font-size', state.settings.fontSize + 'px');
          
          lineNumbersToggle.checked = state.settings.lineNumbers;
          lineNumbersToggle.dispatchEvent(new Event('change'));
          
          wordWrapToggle.checked = state.settings.wordWrap;
          wordWrapToggle.dispatchEvent(new Event('change'));
          
          autoSaveToggle.checked = state.settings.autoSave;
          setupAutoSave();
        } catch (e) {
          console.error('Failed to load settings:', e);
        }
      }
      
      // Export settings
      $('#exportSettings').addEventListener('click', () => {
        const settings = {
          theme: state.theme,
          settings: state.settings,
          history: state.history
        };
        
        const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ctcpro-settings.json';
        a.click();
        URL.revokeObjectURL(url);
        toast('Settings exported', 'success');
      });
      
      // Import settings
      $('#importSettings').addEventListener('click', () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (!file) return;
          
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const settings = JSON.parse(event.target.result);
              
              // Apply theme
              if (settings.theme && settings.theme !== state.theme) {
                if (settings.theme === 'light') {
                  document.body.classList.add('light-theme');
                  themeToggle.innerHTML = '<i class="fas fa-sun"></i> Theme';
                } else {
                  document.body.classList.remove('light-theme');
                  themeToggle.innerHTML = '<i class="fas fa-moon"></i> Theme';
                }
                state.theme = settings.theme;
              }
              
              // Apply settings
              if (settings.settings) {
                if (settings.settings.fontSize) {
                  fontSizeInput.value = settings.settings.fontSize;
                  fontSizeValue.textContent = settings.settings.fontSize + 'px';
                  document.documentElement.style.setProperty('--editor-font-size', settings.settings.fontSize + 'px');
                }
                
                if (settings.settings.lineNumbers !== undefined) {
                  lineNumbersToggle.checked = settings.settings.lineNumbers;
                  lineNumbersToggle.dispatchEvent(new Event('change'));
                }
                
                if (settings.settings.wordWrap !== undefined) {
                  wordWrapToggle.checked = settings.settings.wordWrap;
                  wordWrapToggle.dispatchEvent(new Event('change'));
                }
                
                if (settings.settings.autoSave !== undefined) {
                  autoSaveToggle.checked = settings.settings.autoSave;
                  setupAutoSave();
                }
                
                state.settings = { ...state.settings, ...settings.settings };
              }
              
              // Apply history
              if (settings.history) {
                state.history = settings.history;
                updateHistoryDisplay();
              }
              
              toast('Settings imported', 'success');
            } catch (e) {
              toast('Invalid settings file', 'error');
            }
          };
          reader.readAsText(file);
        };
        input.click();
      });

      // clear all storage
      $('#clearAll').addEventListener('click', () => {
        if (confirm('Are you sure you want to clear all localStorage data for this tool?')) {
          Object.keys(localStorage).filter(k => k.startsWith('ctcpro:')).forEach(k => localStorage.removeItem(k));
          state.history = [];
          updateHistoryDisplay();
          toast('Local data cleared', 'success');
        }
      });

      // --- Individual word wrap toggles for each editor
      function setupWordWrapToggle(buttonId, textareaId) {
        $(buttonId)?.addEventListener('click', () => {
          const textarea = $(textareaId);
          if (!textarea) return;
          
          textarea.classList.toggle('word-wrap');
          const isWrapped = textarea.classList.contains('word-wrap');
          toast(isWrapped ? 'Word wrap enabled' : 'Word wrap disabled', 'success');
        });
      }
      
      setupWordWrapToggle('#toggleWordWrap', 'inputText');
      setupWordWrapToggle('#toggleCodeWordWrap', 'codeInput');
      setupWordWrapToggle('#toggleDecoderWordWrap', 'encoded');
      setupWordWrapToggle('#toggleCombineHtmlWordWrap', 'combineHtml');
      setupWordWrapToggle('#toggleCombineCssWordWrap', 'combineCss');
      setupWordWrapToggle('#toggleCombineJsWordWrap', 'combineJs');
      setupWordWrapToggle('#toggleCombinedOutputWordWrap', 'combinedOutput');
      setupWordWrapToggle('#toggleSplitInputWordWrap', 'splitInput');
      setupWordWrapToggle('#toggleSplitHtmlWordWrap', 'splitHtml');
      setupWordWrapToggle('#toggleSplitCssWordWrap', 'splitCss');
      setupWordWrapToggle('#toggleSplitJsWordWrap', 'splitJs');

      // --- Keyboard Shortcuts
      document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + S: Save
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
          e.preventDefault();
          $('#saveLocal').click();
        }
        
        // Ctrl/Cmd + O: Load
        if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
          e.preventDefault();
          $('#loadLocal').click();
        }
        
        // Ctrl/Cmd + F: Find/Replace
        if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
          e.preventDefault();
          showFindReplace();
        }
        
        // Ctrl/Cmd + T: Toggle Theme
        if ((e.ctrlKey || e.metaKey) && e.key === 't') {
          e.preventDefault();
          toggleTheme();
        }
        
        // Ctrl/Cmd + Shift + C: Copy with line numbers
        if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'C') {
          e.preventDefault();
          const activePanel = $('.panel.active');
          if (activePanel) {
            const textarea = activePanel.querySelector('textarea.editor:not([readonly])');
            if (textarea) {
              copyWithLineNumbers(textarea.id);
            }
          }
        }
        
        // Ctrl/Cmd + R: Reset
        if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
          e.preventDefault();
          $('#reset').click();
        }
        
        // Escape: Close modals
        if (e.key === 'Escape') {
          if (state.findReplace.isActive) {
            hideFindReplace();
          }
        }
      });

      // --- Load history
      const savedHistory = localStorage.getItem(saveKey('history'));
      if (savedHistory) {
        try {
          state.history = JSON.parse(savedHistory);
          updateHistoryDisplay();
        } catch (e) {
          console.error('Failed to load history:', e);
        }
      }

      // utility: download blob
      function downloadBlob(text, type, filename) {
        const blob = new Blob([text], { type });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(() => URL.revokeObjectURL(a.href), 1000);
      }

      // expose some useful things to global for debugging (optional)
      window.ctc = {
        downloadBlob,
        minifyHTML,
        cleanCSS,
        cleanJS,
        toast,
        state,
        switchTool
      };
    })();
  </script>
</body>
</html>